steps:
  - name: "find k8s namespace"
    type: script
    file: "$SERVICE_PATH/scripts/find_namespace"
  - name: "build context"
    type: script
    file: "$SERVICE_PATH/scripts/build_context"
    output:
      - name: SERVICE_ID
        type: environment
      - name: SERVICE_NAME
        type: environment
      - name: ACTION_ID
        type: environment
      - name: ACTION_NAME
        type: environment
      - name: LINK_ID
        type: environment
      - name: LINK_NAME
        type: environment
      - name: SCOPE_ID
        type: environment
      - name: RULE_PATH
        type: environment
  - name: "build template"
    type: script
    file: "$SERVICE_PATH/scripts/build_ingress"
    configuration:
      TEMPLATE: "$SERVICE_PATH/templates/empty.yaml.tpl"
    output:
      - name: INGRESS_FILE
        type: file
        file: "$OUTPUT_DIR/ingress-$SERVICE_ID-$SCOPE_ID-public.yaml"
  - name: apply
    type: script
    file: "$SERVICE_PATH/scripts/apply"
    configuration:
      ACTION: apply
      DRY_RUN: false