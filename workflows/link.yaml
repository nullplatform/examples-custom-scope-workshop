configuration:
  K8S_NAMESPACE: nullplatform
steps:
  - name: "build context"
    type: script
    file: "$SERVICE_PATH/scripts/build_context"
    output:
      - name: SERVICE_ID
        type: environment
      - name: SERVICE_NAME
        type: environment
      - name: ACTION_ID
        type: environment
      - name: ACTION_NAME
        type: environment
      - name: LINK_ID
        type: environment
      - name: LINK_NAME
        type: environment
      - name: SCOPE_ID
        type: environment
      - name: RULE_PATH
        type: environment
  - name: "validate_unique_rule"
    type: script
    file: "$SERVICE_PATH/scripts/validate_unique_rule"
  - name: "build_rule"
    type: script
    file : "$SERVICE_PATH/scripts/build_rule"
    output:
      - name: SCOPE_RULE
        type: environment
  - name: "build_ingress"
    type: script
    file: "$SERVICE_PATH/scripts/build_ingress_with_rule"
    output:
      - name: INGRESS_FILE
        type: file
        file: "$OUTPUT_DIR/ingress-$SERVICE_ID-$SCOPE_ID-public.yaml"
  - name: apply
    type: script
    file: "$SERVICE_PATH/scripts/apply"
    configuration:
      ACTION: apply
      DRY_RUN: false
  - name: "add_rule_to_service"
    type: script
    file: "$SERVICE_PATH/scripts/update_service"
    configuration:
      ACTION: add